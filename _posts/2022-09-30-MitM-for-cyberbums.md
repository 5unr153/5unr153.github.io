---
title: MiTM for CyberBums
date: 2022-09-30 00:28:00 +0300
categories: Network
---

# Some theory about AP

Rough AP attack old as as Wi-Fi. When some one create access point with same name, it has begun. Principe of the attack is very easy. Let's Imagine what you have home wi-fi network "Mysweethome". You connect your shiny smartphone to the home network and surfing the internet. Wthen you go to the grocery. When you look at you phone screen, there is no you network. Course, because you out of range. But when you come back, and look at your phone, you notice it alredy connected to "Mysweethome" network. But you don't connect it to home network again. How it happend? Looks like you phone connect to the network automaticly. But how it know about network?  "Oh, it just found you home network near and connect to it, you stupid..." - that's right. But how it found it? For answer on this question, let's think, what happens, when you open "avaliable networks" menu at you device. How you device known, what networks around? Because access points talks about itself. They send broadcast frames with information about networks, include name or "SSID". This frames calls "beacons". Ok, it's more clear now. Phone always listen radio waves, and when recived beacon with known network, try to connect. Good. But let's imagine, you don't want what's you neighbors known about you wifi point name. You create "hidden" access point. You device connect to network and don't receive any Beacon from station now. You return home after hard day, and in addition you need to connect your device to the home network. You turn on the screen, but you device alredy connected again! What's a miracle! Device known about you network. But network is hidden! How it know?! And why neighbors don't know? Or they known and this "hidden" network just marketing trick? Don't worry. You network really hidden and don't send any beacons. Now we talk about another type of frames. The "Probes". If you device have preffered networks, it always check, is there some of known networks around. It do it, sending broadcast probe-request frame. Asking all around "Hey! is 'Mysweethome'  access point here?!". If acces point really near, it send response, or "probe-response". "Yeah! I'm 'Mysweethome' point! Here is my parameters." And connection begins. The "hidden" network asking for probe-requsts as any other netowk, if you know it SSID. But what happens if you are not alone in the city, who names home WiFi "Mysweethome"? What happens if you come near this AP? Well. You device just see known name and try to connect! Yes! No any verification in this part of connection establishing. If network is open, or if network keys a same (what strange), you automatically connect to the network, you don't even known about. So, if it happened accidentally, it's collision, if you company make many AP's with one network name in office building - it's roaming, if you make it, because you want - it's rough AP attack.

![handshake](/assets/images/wifi_bums/connection.png)
_Wi-Fi connection establishing_

# Rough AP and MitM
Ok, you automatically connect to the "starbucks" network in the middle of the forest. Well, it's happening. What the danger? Well, now let's talk about MitM, or "Man in the middle". That's mean what man, who control AP, can see and modify all you internet traffic! Is it dangerous? Course yes! But you have a friend, who protect you - encryption!  What the difference between HTTP and HTTPS? Well, http is a protocol for web interconnection. Inside http is a plain text. Yes, all you data is human readable, if you capture HTTP packets. Even passwords. Evil man even don't need to decode bytes or something like this. Just capture and read. But in https all you data are encrypted. That's why so important to check lock icon in url address. But evil man still have some tricks in his dirty hand) For example he can create malicious captive portal. It's a page for autentification in public places like restaurants or hotels. Captive portals use just http, so you can't validate it. And here evil man can draw you anything. The most easy way is just ask a credentials. "For access to the internet please login via facebook or google account" with form where you can enter you login and password and send it to evil man. But if he clever, he even can give you "root" certificate for install, for example if you connect to network looking like you office network  -"The new rules of our company. Please install company security cetificate for access to company resources or you will be banned in 24 hour". And then he will you in virtual reality jail. You will think that you are visiting websites in the internet, but really all of them will be automatically drawed by evil man and looks like "secure" with lock icon. So, when you'll try to login in facebook, or in your bank account or work email and enter you credentials - gotcha! Even 2FA don't save you. Because you'll give attacker and second factor too. Some mobile applications have "pinned" certificates. That's mean application doesn't believe any certificate on device. Only own's. In this case it help.

![Phishing](/assets/images/wifi_bums/phish.jpg)
_Phishing page, created by Wifiphisher framework_

# MitM fo10\$
I noticed what some, even cheap routers have cool functionality, which in combine give you the perfect wireless mitm tool. I talk about "wireless WAN" and "multi SSID" fuctions. Let's look closer. A wireless WAN gives your network device  ability  to access the Internet not only from an ISP by wire, but also from any wireless network. In fact, you network device connect as station and route all LAN traffic through wireless network which it connected. It's very good solution for some country areas for example. The next feature is "Multiple SSID". As the name suggest, it gives you ability create several Wireless networks with different names. The number of networks depends on the router model and firmware. I bough netis wf2419 only for 6\$. Well, it costs 10, but i have discount... and this model have 3 addition SSID, which you can broadcast. But if you have Mikrotik, or any other  router with openWRT firmware, you can create almost infinity numbers of SSID's. And you can control all of them. On the huawei AP i create 20 SSID's of common public places from my town. Who need Karma and preferred list attack if we have cannon like this. In addtion you don't even need laptop or any other stuff. Just configure you router, and drop it in where you need. With price 5-10\$ it's some kind of expendeble. I don't specifically tell you which attacks you can do, because world have enough script kiddies, but Infosec specialists know all this technics.

![Netis](/assets/images/wifi_bums/netis.jpg)


# Future plans

Automation of course! let's monitor probes from devices and create new networks. I know, i reinvited Karma. Karma with lags, you know. But in this case you don't even need special adapter o specific drivers. Just router and sniffing device. ESP32 for example. No laptops, no even raspberry pi, no alfa networks adapter with monster-like antennas.
